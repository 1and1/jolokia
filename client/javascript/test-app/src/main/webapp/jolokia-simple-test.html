<!--
  ~ Copyright 2009-2010 Roland Huss
  ~
  ~ Licensed under the Apache License, Version 2.0 (the "License");
  ~ you may not use this file except in compliance with the License.
  ~ You may obtain a copy of the License at
  ~
  ~ http://www.apache.org/licenses/LICENSE-2.0
  ~
  ~ Unless required by applicable law or agreed to in writing, software
  ~ distributed under the License is distributed on an "AS IS" BASIS,
  ~ WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  ~ See the License for the specific language governing permissions and
  ~ limitations under the License.
  -->

<!-- Jolokia Javascript Client Lib Unit test -->
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                    "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
  <title>Jolokia Javascript (simple) Testsuite</title>
  <script type="text/javascript" src="scripts/jquery-1.4.4.js"></script>
  <script type="text/javascript" src="scripts/qunit.js"></script>
  <script type="text/javascript" src="scripts/lib/jolokia.js"></script>
  <script type="text/javascript" src="scripts/lib/jolokia-simple.js"></script>
  <script type="text/javascript" src="scripts/lib/json2.js"></script>

  <link rel="stylesheet" href="css/qunit.css" type="text/css" media="screen" />
  <script>
  $(document).ready(function(){

    var j4p = new Jolokia("/jolokia");

    module("Simplified requests");
    test("get_attribute (sync)",function() {
      var value = j4p.getAttribute("java.lang:type=Memory","HeapMemoryUsage","used");
      ok(value > 0,"Positive used HeapMemory");
      value = j4p.getAttribute("java.lang:type=Memory","HeapMemoryUsage");
      ok(value.used,"Composite Data returned");
      value = j4p.getAttribute("java.lang:type=Memory",["HeapMemoryUsage","NonHeapMemoryUsage"]);
      ok(value.HeapMemoryUsage.max,"Multi attribute read, HeapMemoryUsage.max");
      ok(value.NonHeapMemoryUsage.used,"Multi attribute read, HeapMemoryUsage.used");
      value = j4p.getAttribute("java.lang:type=Memory");
      ok(value.HeapMemoryUsage.max,"All attribute read, HeapMemoryUsage.max");
      ok(value.NonHeapMemoryUsage.used,"All attribute read, HeapMemoryUsage.used");
      value = j4p.getAttribute("java.lang:type=*");
      ok(value["java.lang:type=Memory"].HeapMemoryUsage.max,"Pattern read, java.lang:type=Memory,HeapMemoryUsage.max");
      value = j4p.getAttribute("bla:blub=x",{ method: "get" });
      ok(value == null,"Error call");
    });

    asyncTest("get_attribute (sync with error)",function() {
      var value = j4p.getAttribute("bla:blub=x",{ error: function(resp) {
        equals(resp.error_type,"javax.management.InstanceNotFoundException","Exception type");
        start();
      }});
      ok(value == null,"Error call");
    });

    asyncTest("get_attribute (async)",function() {
      var value = j4p.getAttribute("java.lang:type=Memory","HeapMemoryUsage","used", {
        success: function(val) {
          ok(val > 0,"Positive HeapMemory");
          start();
        }
      });
     // ok(value == null,"No sync return value");
    });

    function log(response) {
      console.log(JSON.stringify(response));
    }

  });

  </script>
</head>

<body>
<h1 id="qunit-header">Jolokia QUnit Testsuite</h1>
<h2 id="qunit-banner"></h2>
<div id="qunit-testrunner-toolbar"></div>
<h2 id="qunit-userAgent"></h2>
<ol id="qunit-tests"></ol>
<div id="qunit-fixture">test markup, will be hidden</div>
</body>
</html>